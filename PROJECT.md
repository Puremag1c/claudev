# Claudev — Project Context

## Что это за проект

**Claudev** — многоагентная система автоматической разработки на базе Claude Code.

Система позволяет запустить полностью автономную разработку проекта: менеджер координирует работу архитектора, кодеров, ревьюеров и помощников. Состояние хранится в Beads, работа идёт через bash orchestrator.

## Цель

Система должна легко интегрироваться в любой проект через `git clone`.

## Структура проекта

```
claudev/
├── CLAUDE.md              # Персональный ассистент (переносится между проектами)
├── PROJECT.md             # ← Этот файл (контекст проекта)
├── core/                  # Ядро системы
│   ├── agents/            # Шаблоны агентов (manager, architect, coder...)
│   ├── commands/          # Slash-команды (/start, /status)
│   └── scripts/           # Bash скрипты (orchestrator, claim-task...)
├── templates/             # Шаблоны для целевого проекта
│   ├── SPEC.template.md   # Шаблон спецификации
│   └── CLAUDE.template.md # Шаблон CLAUDE.md для проекта
├── install.sh             # Установщик в целевой проект
└── docs/                  # Документация
    └── architecture.md    # Архитектура системы
```

## ВАЖНО: Работа с файлами агентов

Файлы в `core/agents/*.md` — это **КОД ПРОЕКТА**, а не инструкции для текущей сессии Claude.

При работе над claudev я редактирую эти файлы как обычный исходный код. Они станут инструкциями только когда система будет установлена в целевой проект и запущена через orchestrator.

## Как система интегрируется в проект

```bash
# В целевом проекте:
git clone git@github.com:user/claudev.git .claudev
.claudev/install.sh

# Результат:
target-project/
├── .claudev/              # Клонированное ядро
├── .claude/               # Симлинки на agents и commands
│   ├── agents -> ../.claudev/core/agents
│   └── commands -> ../.claudev/core/commands
├── scripts -> .claudev/core/scripts
├── SPEC.md                # Спецификация проекта (заполняет пользователь)
└── CLAUDE.md              # Project instructions
```

## Ключевые компоненты системы

### Агенты (core/agents/)

| Агент | Модель | Роль |
|-------|--------|------|
| manager | Sonnet | Координатор, хранит состояние в Beads, принимает решения |
| architect | Opus | Создаёт план из SPEC.md, назначает модели задачам |
| coder | По задаче | Реализует ОДНУ задачу за сессию |
| reviewer | Sonnet | Проверяет код, создаёт баг-репорты |
| analyst | Opus | Оценивает готовность плана |
| helper-* | Sonnet | Аудит плана (architecture, reliability, ux, ops) |

### Скрипты (core/scripts/)

| Скрипт | Назначение |
|--------|------------|
| orchestrator.sh | Главный цикл, пингует менеджера каждые N секунд |
| init-manager.sh | Инициализация состояния менеджера в Beads |
| claim-task.sh | Атомарный захват задачи (без race conditions) |
| detect-phase.sh | Определение текущей фазы проекта |
| run-helpers.sh | Параллельный запуск помощников |
| run-coders.sh | Параллельный запуск кодеров |

### Фазы проекта

```
INIT → PLANNING → HELPERS → PLAN_REVIEW → IMPLEMENTATION → FINAL_REVIEW → DONE
```

## Зависимости

- **Beads** — система управления задачами (bd CLI)
- **Claude Code** — CLI для запуска агентов
- **Bash** — для orchestrator и скриптов

## Ключевые требования

### Целевая аудитория
- Непрограммисты, которые могут чётко отвечать на вопросы
- От словесного описания → к готовому продукту

### Принципы системы
- **Полная автономность** — не copilot, а отдел разработки
- **Итеративность** — MVP → доработка → доработка (не overthinking)
- **Короткие задачи** — каждый task в beads = 1-5 минут Sonnet
- **Персистентность** — всё в Beads, любой воркер может упасть

### Пайплайн ролей
```
Vision (заказчик)
    ↓
Tech Writer (собирает требования, задаёт вопросы, формирует ТЗ)
    ↓
Architect (план, разбивка на задачи, зависимости)
    ↓
Analysts (UX / Security / OPS / Reliability / Architecture)
    ↓
Senior Analyst (финальный review плана)
    ↓
Architect (доработка плана по feedback)
    ↓
Executors (реализация задач)
    ↓
Senior Executor (проверка результатов)
    ↓
CI/CD GitHub
```

### Управление процессом
- Manager в цикле (пока нет лучшего решения)
- Таймауты для управления падениями (задача > 10 мин = проблема)
- Beads как единственный источник правды

---

## Текущий статус

Базовая структура (набросок):
- [x] core/ — агенты, команды, скрипты
- [x] templates/ — шаблоны SPEC.md и CLAUDE.md
- [x] install.sh — установщик
- [x] docs/ — документация

**Статус:** Требуется редизайн под новые требования

**Обсуждено (22 января 2026):**
- ✅ Tech Writer — Opus, сам пишет в beads, режимы (новый/итерация)
- ✅ Manager — Sonnet, stateless, определяет фазу по beads
- ✅ Архитектура — subagents + beads, каждый агент сам пишет состояние
- ✅ Отказоустойчивость — retry 3x, эскалация к Architect, лимит 2
- ✅ UX — 4 статуса, варианты для user, clarification vs decision
- ✅ Итерации — SPEC.md с секциями Iteration N

**Обсуждено (23 января 2026):**
- ✅ Senior Analyst — убран, избыточен
- ✅ Противоречия между аналитиками — решает Architect
- ✅ Приоритет: Security > UX (избыточные меры убираем итерациями)
- ✅ Аналитики только ДОБАВЛЯЮТ задачи, Architect может УДАЛЯТЬ (дубликаты, избыточность)
- ✅ Manager — единая точка координации, Architect не ждёт аналитиков сам
- ✅ Формат задачи в beads для Executor:
  ```
  title: краткое описание (1-2 предложения)
  files: какие файлы трогать (1-3)
  done_when: чёткий критерий готовности
  ```
- ✅ Гранулярность задач — эвристика: "если есть 'и' — это 2 задачи", "больше 3 файлов — разбей"

**Осталось обсудить:**
- [ ] Analysts — нужны ли все 4 (UX/Security/OPS/Reliability) для MVP
- [ ] Executors — параллельно или последовательно, git workflow
- [ ] Тестирование — кто пишет тесты
- [ ] MVP системы — что реализуем первым
